<html>
  <head>
    <title>InnKeeper Admin Panel</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script  type="text/javascript">
      var stompClient;
      var id;
      function connect() {
          var socket = new SockJS('/stomp');
          stompClient = Stomp.over(socket);
          stompClient.connect({}, function (frame) {
              console.log('Connected: ' + frame);
              fetch('/ws/token')
                .then(response => response.json()) // This converts the response body to a string
                .then(data => {
                  // Use the string data here
                  stompClient.send("/api/connect", {}, JSON.stringify(data));
                });
              
              stompClient.subscribe('/user/client/command/session/send', function (msg) {
                console.log(msg);
                document.getElementById("response").value=msg.body;
              });
              stompClient.subscribe('/user/client/command/session/create', function (msg) {
                document.getElementById("body").value=`["${msg.body}", "ls"]`;
                document.getElementById("codeBody").value=`{"uuid":"${msg.body}","aChar":""}`;
                stompClient.subscribe('/client/command/session/send/'+msg.body, function (msg) {
                  document.getElementById("response").value=document.getElementById("response").value+msg.body;
                });
                
              });
              stompClient.subscribe('/user/client/connected', function (msg) {
                stompClient.send("/api/command/session/create", {}, JSON.stringify(["innkeeper","example-site-6875f5bbf5-stptl"]));
              });
          });
          
      }

      function disconnect() {
          if (stompClient !== null) {
              stompClient.disconnect();
          }
          setConnected(false);
          console.log("Disconnected");
      }

      function send() {
       stompClient.send("/api/command/session/send", {}, document.getElementById("body").value);
      }
      function sendCode() {
       stompClient.send("/api/command/session/send_code", {}, document.getElementById("codeBody").value);
      }
    </script>
  </head>
  <body>
    Admin Panel pull from repo.
    <br/>
    <input type="button" onclick="connect();" value="connect"/>
    <br/><br/><br/>
    <form action="javascript: sendCode();">
      <input type="text" id="codeBody" style="width:600px;"><br/>
      <input type="submit" value="sendCode"/>
    </form>
    <br/>
    <form action="javascript: send();">
      <input type="text" id="body" style="width:600px;"><br/>
      <input type="submit" value="send"/>
    </form>
    <br/><br/><br/>
    <textarea id="response" style="height:700px;width:900px;"></textarea>
  </body>
</html>
